var counter = parseInt(counter);
var radarTicket = execution.getRadarTicket();

var i = radarTicket.getCorrelatedTickets().size(); 

function setVariables(correlatedTicket) {
    var hostName = correlatedTicket.getIpmonTicketMapping().getHost();
    var hostService = correlatedTicket.getIpmonTicketMapping().getService();
    var ipmonName = correlatedTicket.getIpmonTicketMapping().getIpmonHost();
    ipmonName = String( ipmonName.toString() ).replace( RegExp( /(\w+)-IPmon(\d+)-(\w+)-(\w+)/ ), String("ipmon$2.$3-$4.$1.ipsoft.com")  );

    execution.getExecutionVariableForScope("host", executionPointer.getCurrentScope()).setValue(hostName);
    execution.getExecutionVariableForScope("service", executionPointer.getCurrentScope()).setValue(hostService);
    execution.getExecutionVariableForScope("counter", executionPointer.getCurrentScope()).setValue(counter + 1);
    execution.getExecutionVariableForScope("ipmon", executionPointer.getCurrentScope()).setValue(ipmonName);
}

function checkTicket(){
    if (counter >= i){
        return "done";
    } else {
        var ticket = radarTicket.getCorrelatedTickets().get(counter);

        if(ticket.getIpmonTicketMapping() != null){ 
             setVariables(ticket);
              return "next";
        } else {
             counter = counter + 1;
             execution.getExecutionVariableForScope("counter", executionPointer.getCurrentScope()).setValue(counter);
             checkTicket();
        }

    }
}

checkTicket();
